// Generated by CoffeeScript 1.2.1-pre
(function() {
  var load_result, normalize, results_tmpl;

  normalize = function(q) {
    return q.toLowerCase().replace(/[ ]+/g, ' ').trim();
  };

  results_tmpl = '\
<h1>{{person_name}} has {{count}} records</h1>\
<table border="1">\
  <tr>\
    <td>Person Name</td>\
    <td>Team Name</td>\
    <td>Description</td>\
    <td>Duration</td>\
    <td>Date</td>\
    <td>Score</td>\
  </tr>\
  {{#results}}\
  <div class="result">\
  <tr>\
  <td>{{person_name}}</td>\
  <td>{{team}}</td>\
  <td>{{description}}</td>\
  <td>{{duration}}</td>\
  <td>{{date}}</td>\
  <td>{{score}}</td>\
  </tr>\
  </div>\
  {{/results}}\
</table>\
';

  load_result = function(q) {
    var url;
    console.log('load_result is called, q is ' + q);
    if (!q) {
      url = '/records/all';
      console.log('all case');
    } else {
      url = '/records/' + encodeURIComponent(q);
      console.log('individual case');
    }
    return $.getJSON(url, function(json) {
      var rendered;
      rendered = Mustache.render(results_tmpl, json);
      return $('#results').html(rendered);
    });
  };

  $(function() {
    console.log('document load ready');
    load_result('');
    return $('.search-button button').click(function() {
      var q;
      console.log('start');
      q = normalize($('#search-bar').val());
      return load_result(q);
    });
  });

}).call(this);
